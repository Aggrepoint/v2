var AeEditDrag={R_UITYPE:new RegExp("uitype#(.+?)#"),m_arrAreas:null,m_arrAreaRects:null,m_arrConts:null,m_arrContRects:null,m_elmMove:null,m_elmDropIndicate:null,m_elmArea:null,m_elmContent:null,m_elmContentRect:null,m_offsetMove:null,m_funcDrop:null,m_funcStart:null,m_funcEnd:null,init:function(d,c,b){if(d!=null){m_funcDrop=d;AeEditDrag.findAreasAndContents();var a=$(".uitype\\#drag\\#");a.css("cursor","move");a.mousedown(AeEditDrag.doMouseDown);$(document).mousemove(AeEditDrag.doMouseMove);$(document).mouseup(AeEditDrag.doMouseUp)}m_funcStart=c;m_funcEnd=b},initArrObjects:function(b,e,c){if(e==null){return}var a=e.className.match(AeEditDrag.R_UITYPE);if(a!=null){if(AeEditDrag.m_elmContent!=null&&$(AeEditDrag.m_elmContent).attr("group")!=$(e).attr("group")){return}e.uitype=a[1];if(e.uitype==c){b[b.length]=e}}var d;for(d=0;d<e.children.length;d++){AeEditDrag.initArrObjects(b,e.children[d],c)}},getRect:function(c){var b=$(c);var a=b.offset();a.width=b.outerWidth();a.height=b.outerHeight();a.bottom=a.top+a.height;a.right=a.left+a.width;return a},getPosiRect:function(c){var b=$(c);var a=b.position();a.width=b.outerWidth();a.height=b.outerHeight();a.bottom=a.top+a.height;a.right=a.left+a.width;return a},clearSelection:function(){try{if(window.getSelection){if(window.getSelection().empty){window.getSelection().empty()}else{if(window.getSelection().removeAllRanges){window.getSelection().removeAllRanges()}}}else{if(document.selection){document.selection.empty()}}}catch(a){}},newRect:function(d,c,a,b){return{top:d,left:c,bottom:a,right:b,width:b-c,height:a-d}},getElement:function(b,a){if(!a){return null}while(b){if(b.uitype==a){return b}b=b.parentNode}return null},findAreasAndContents:function(){AeEditDrag.m_arrAreas=new Array();AeEditDrag.initArrObjects(AeEditDrag.m_arrAreas,window.document.body,"area");AeEditDrag.m_arrAreaRects=new Array();for(i=0;i<AeEditDrag.m_arrAreas.length;i++){AeEditDrag.m_arrAreaRects[i]=AeEditDrag.getRect(AeEditDrag.m_arrAreas[i]);AeEditDrag.m_arrAreas[i].container=AeEditDrag.getElement(AeEditDrag.m_arrAreas[i],"cont")}AeEditDrag.m_arrConts=new Array();AeEditDrag.initArrObjects(AeEditDrag.m_arrConts,window.document.body,"cont");AeEditDrag.m_arrContRects=new Array();for(i=0;i<AeEditDrag.m_arrConts.length;i++){AeEditDrag.m_arrContRects[i]=AeEditDrag.getRect(AeEditDrag.m_arrConts[i])}},findArea:function(a,c){var b;for(b=AeEditDrag.m_arrAreaRects.length-1;b>=0;b--){if(a>=AeEditDrag.m_arrAreaRects[b].left&&a<=AeEditDrag.m_arrAreaRects[b].right&&c>=AeEditDrag.m_arrAreaRects[b].top&&c<=AeEditDrag.m_arrAreaRects[b].bottom){return AeEditDrag.m_arrAreas[b]}}return null},findCont:function(a,c){var b;for(b=AeEditDrag.m_arrContRects.length-1;b>=0;b--){if(a>=AeEditDrag.m_arrContRects[b].left&&a<=AeEditDrag.m_arrContRects[b].right&&c>=AeEditDrag.m_arrContRects[b].top&&c<=AeEditDrag.m_arrContRects[b].bottom){return b}}return null},doMouseDown:function(b){if(b.which!=1){return}AeEditDrag.m_elmContent=AeEditDrag.getElement(b.target,"cont");if(AeEditDrag.m_elmContent==null){return}AeEditDrag.m_elmArea=AeEditDrag.getElement(AeEditDrag.m_elmContent,"area");if(m_funcStart){m_funcStart()}AeEditDrag.findAreasAndContents();AeEditDrag.m_elmContentRect=AeEditDrag.getRect(AeEditDrag.m_elmContent);var a=AeEditDrag.getPosiRect(AeEditDrag.m_elmContent);AeEditDrag.m_elmMove=$("<div></div>");AeEditDrag.m_elmMove.append($(AeEditDrag.m_elmContent).clone());AeEditDrag.m_elmMove.addClass("ae_drag");AeEditDrag.m_elmMove.css("left",a.left);AeEditDrag.m_elmMove.css("top",a.top);AeEditDrag.m_elmMove.css("width",a.width);AeEditDrag.m_offsetMove=new Object();AeEditDrag.m_offsetMove.x=a.left-b.pageX;AeEditDrag.m_offsetMove.y=a.top-b.pageY;$(AeEditDrag.m_elmContent.parentNode).append(AeEditDrag.m_elmMove);$(AeEditDrag.m_elmContent).css("opacity",0.5);AeEditDrag.m_elmMove.css("opacity",0.5);AeEditDrag.clearSelection()},findDropLocation:function(a,c){if(a>=AeEditDrag.m_elmContentRect.left&&a<=AeEditDrag.m_elmContentRect.right&&c>=AeEditDrag.m_elmContentRect.top&&c<=AeEditDrag.m_elmContentRect.bottom){return null}var b=new Object();b.area=AeEditDrag.findArea(a,c);if(b.area==null){return null}contIdx=AeEditDrag.findCont(a,c);if(contIdx!=null&&AeEditDrag.m_arrConts[contIdx]!=b.area.container){b.content=AeEditDrag.m_arrConts[contIdx];b.before=c<AeEditDrag.m_arrContRects[contIdx].top+AeEditDrag.m_arrContRects[contIdx].height/2}if(b.content==null&&b.area==AeEditDrag.m_elmArea){return null}return b},showDropPoint:function(a,c){if(AeEditDrag.m_elmDropIndicate!=null){AeEditDrag.m_elmDropIndicate.remove()}var b=AeEditDrag.findDropLocation(a,c);window.status=b;if(b==null){return}AeEditDrag.m_elmDropIndicate=$("<div></div>");AeEditDrag.m_elmDropIndicate.addClass("ae_drop");if(b.content!=null){if(b.before){$(b.content).before(AeEditDrag.m_elmDropIndicate)}else{$(b.content).after(AeEditDrag.m_elmDropIndicate)}}else{$(b.area).append(AeEditDrag.m_elmDropIndicate)}},doMouseMove:function(a){if(AeEditDrag.m_elmMove==null||AeEditDrag.m_offsetMove==null){return}AeEditDrag.clearSelection();AeEditDrag.m_elmMove.css("left",a.pageX+AeEditDrag.m_offsetMove.x);AeEditDrag.m_elmMove.css("top",a.pageY+AeEditDrag.m_offsetMove.y);AeEditDrag.showDropPoint(a.pageX,a.pageY)},doMouseUp:function(b){if(AeEditDrag.m_elmDropIndicate!=null){AeEditDrag.m_elmDropIndicate.remove()}if(AeEditDrag.m_elmContent!=null){$(AeEditDrag.m_elmContent).css("opacity",1);var a=AeEditDrag.findDropLocation(b.pageX,b.pageY);if(a!=null){if(a.content==null){$(a.area).append(AeEditDrag.m_elmContent)}else{if(a.before){$(a.content).before(AeEditDrag.m_elmContent)}else{$(a.content).after(AeEditDrag.m_elmContent)}}m_funcDrop(AeEditDrag.m_elmContent,a)}AeEditDrag.m_elmContent=null}if(AeEditDrag.m_elmMove!=null){AeEditDrag.m_elmMove.remove();AeEditDrag.m_elmMove=null}if(m_funcEnd){m_funcEnd()}}};